<!doctype html>

<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="node_modules/lodash/lodash.js"></script>
  <script src="dist/sai-experiment.bundle.js"></script>
  <script>
  (function() {
    var sai = window['sai-experiment'];
    var audioCtx = new AudioContext();
    var instrument = {
      oscillators: [
        {
          type: "sine",
          gain: 1,
          freqOsc: {
            type: "sine",
            amount: 0,
            frequency: 10,
          },
        },
      ],
      filters: [
        {
          type: "highpass",
          frequency: 0,
          gain: 0,
          q: 1000,
        },
      ],
      attack: 0.05,
      decay: 0.05,
      sustainLevel: 0.5,
      sustainTime: 0.2,
      release: 0.1,
      gain: 0.2,

      noise: 0,
      delay: 0,
      delayTime: 0.3,
      panAmount: 0,
      panFrequency: 2,
    };
    var t = new sai.Track(audioCtx, instrument);
    t.output.connect(audioCtx.destination);
    
    console.log("trying to get midi access");
    window.navigator.requestMIDIAccess().then(function(midiAccess) {
      console.log("midi access granted");
      var inputs = midiAccess.inputs.values();
      for (var input = inputs.next(); input && ! input.done; input = inputs.next()) {
        input.value.onmidimessage = receiveMessage;
      }
    });
    
    var receiveMessage = function(mm) {
      var message = new sai.MidiMessage(mm.data);
      console.log(message);
      t.midiMessage(message);
    };
  })();
  </script>
</head>
<body>
  Play with a midi keyboard !
</body>
